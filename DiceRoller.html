<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <!-- Use a templated HTML printing scriptlet to import common stylesheet -->
    <?!= HtmlService.createHtmlOutputFromFile('Stylesheet').getContent(); ?>
    <style>
    /* Container for form and image */
    .form-container {
      display: flex;
      align-items: center; /* Aligns image and form vertically */
    }

    /* Style for the form */
    .form-container form {
      margin-right: 20px; /* Add space between form and image */
    }

    /* Optional: Resize the image */
    .form-container img {
      width: 150px;
      height: 150px;
    }
    </style>
  </head>
  <body>
    <div class="form-container">
      <form>
        <label for="DiceNumber"># of Dice:</label><br>
        <input type="text" id="DiceNumber" name="DiceNumber"><br>
        <label for="LowestNumber">Lowest #:</label><br>
        <input type="text" id="LowestNumber" name="LowestNumber"><br>
        <label for="GreatestNumber">Greatest #:</label><br>
        <input type="text" id="GreatestNumber" name="GreatestNumber"><br>
      </form>

      <img src="https://png.pngtree.com/png-clipart/20240826/original/pngtree-red-dice-with-question-mark-concept-poker-object-photo-png-image_15858522.png" alt="Question Dice" />
    </div>

    <div class="block" id="roll-dice">
      <!-- Button to trigger dice roll -->
      <button class="action" id="roll-dice-button" onclick="rollDice()">Roll</button>
    </div>

    <div class="block" id="add-to-doc">
      <!-- Button to trigger dice roll -->
      <button class="action" id="add-to-doc-button" onclick="addToDoc()">Add To Doc</button>
    </div>

    <h3>Result:</h3>
    <p id="Dice">?</p>

    <h3>Average Roll:</h3>
    <p id="AverageRoll">N/A</p>

    <h3>Roll History:</h3>
    <p id="RollHistory">No rolls yet</p>

    <!-- Client-side JavaScript -->
    <script>
      var totalRolls = 0;
      var totalSum = 0;
      var rolls = [];

      // Function to handle the dice roll logic
      function rollDice() {
        var diceNumber = parseInt(document.getElementById('DiceNumber').value);
        var lowestNumber = parseInt(document.getElementById('LowestNumber').value);
        var greatestNumber = parseInt(document.getElementById('GreatestNumber').value);

        // Validate the inputs
        if (isNaN(diceNumber) || isNaN(lowestNumber) || isNaN(greatestNumber)) {
          alert("Please enter valid numbers.");
          return;
        }

        var results = [];

        // Roll each die
        for (var i = 0; i < diceNumber; i++) {
          // Roll a die (random value between lowestNumber and greatestNumber)
          var rollResult = Math.floor(Math.random() * (greatestNumber - lowestNumber + 1)) + lowestNumber;
          results.push(rollResult);
        }

        // Calculate the sum of the rolls
        var sum = results.reduce(function (a, b) { return a + b; }, 0);

        totalSum += sum;
        totalRolls += results.length;

        var average = totalSum / totalRolls;

        rolls.push(results);

        document.getElementById('Dice').textContent = results.join(",");

        document.getElementById('AverageRoll').textContent = average.toFixed(2);

        document.getElementById('RollHistory').textContent = rolls.join(",");
      }

      function addToDoc() {
        var diceNumber = document.getElementById('DiceNumber').value;
        var lowestNumber = document.getElementById('LowestNumber').value;
        var greatestNumber = document.getElementById('GreatestNumber').value;
        var dice = document.getElementById('Dice').textContent;
        var averageRoll = document.getElementById('AverageRoll').textContent;
        var rollHistory = document.getElementById('RollHistory').textContent;

        google.script.run.insertDiceToDoc(diceNumber, lowestNumber, greatestNumber, dice, averageRoll, rollHistory);
      }
    </script>
  </body>
</html>