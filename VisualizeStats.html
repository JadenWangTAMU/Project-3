<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <!-- Include Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Use a templated HTML printing scriptlet to import common stylesheet -->
    <?!= HtmlService.createHtmlOutputFromFile('Stylesheet').getContent(); ?>
  </head>
  <body>
    <textarea id="name-box" style="width: 50%; height: 30px; margin-top: 10px; text-align:left; font-size:17px; font-style:italic; resize: none;">[Default Character]</textarea>
    <div class="block" id="save-character">
      <button class="action" id="search-character-button" onclick="searchCharacter()">Search Character</button>
    </div>
    <div class="block" id="visualize-stats">
      <!-- The canvas element where the chart will be rendered -->
      <canvas id="statsChart" width="400" height="400"></canvas>
    </div>
    <script>
      function displayChart(result) {
        // Prepare the labels and data from the result
        const labels = ["AC", "HP", "SP", "STR", "DEX", "CON", "INT", "WIS", "CHA"];
        const data = result;

        // Get the context of the canvas element
        const ctx = document.getElementById('statsChart').getContext('2d');

        // Create a new chart
        new Chart(ctx, {
          type: 'bar', // Bar chart
          data: {
            labels: labels, // X-axis labels (character stats)
            datasets: [{
              label: 'Character Stats', // Chart label
              data: data, // Y-axis values (the stats)
              backgroundColor: 'rgba(54, 162, 235, 0.2)', // Bar color
              borderColor: 'rgba(54, 162, 235, 1)', // Border color of the bars
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true, // Make sure the Y-axis starts at 0
              }
            }
          }
        });
      }

      function searchCharacter(){
        const name = document.getElementById("name-box").value;
        var result=google.script.run.withSuccessHandler(displayChart).searchCharacterInDoc(name);
      }
    </script>
  </body>
</html>
