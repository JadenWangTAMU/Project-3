<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <!-- Include Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Use a templated HTML printing scriptlet to import common stylesheet -->
    <?!= HtmlService.createHtmlOutputFromFile('Stylesheet').getContent(); ?>
  </head>
  <body>
    <select id="dropdown" onchange="onDropdownChange()">
      <option value="wizard">Wizard</option>
      <option value="bard">Bard</option>
      <option value="rogue">Rogue</option>
      <option value="cleric">Cleric</option>
    </select>
    <div class="block" id="visualize-stats">
      <!-- The canvas element where the chart will be rendered -->
      <canvas id="statsChart" width="400" height="400"></canvas>
    </div>
    <script>
      // Function that creates the character and displays the stats as a chart
      function createCharacter() {
        google.script.run.withSuccessHandler(displayChart).createCharacterInScript(12, 9, 30, 8, 14, 15, 16, 13, 11);
      }

      // Function to display the stats in a chart
      function displayChart(result) {
        // Prepare the labels and data from the result
        const labels = ["AC", "HP", "SP", "STR", "DEX", "CON", "INT", "WIS", "CHA"];
        const data = result;

        // Get the context of the canvas element
        const ctx = document.getElementById('statsChart').getContext('2d');

        // Create a new chart
        new Chart(ctx, {
          type: 'bar', // Bar chart
          data: {
            labels: labels, // X-axis labels (character stats)
            datasets: [{
              label: 'Character Stats', // Chart label
              data: data, // Y-axis values (the stats)
              backgroundColor: 'rgba(54, 162, 235, 0.2)', // Bar color
              borderColor: 'rgba(54, 162, 235, 1)', // Border color of the bars
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true, // Make sure the Y-axis starts at 0
              }
            }
          }
        });
      }

      // Call createCharacter function as soon as the page loads
      window.onload = createCharacter;
    </script>
  </body>
</html>
